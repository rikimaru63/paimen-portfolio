<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãŠå•ã„åˆã‚ã› | AIè‡ªå‹•è¿”ä¿¡ãƒ‡ãƒ¢</title>
<meta name="description" content="AIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã«ã‚ˆã‚‹ãŠå•ã„åˆã‚ã›è‡ªå‹•è¿”ä¿¡ãƒ‡ãƒ¢ã€‚ã‚¹ãƒ†ãƒƒãƒ—å½¢å¼ã®ãƒ•ã‚©ãƒ¼ãƒ ã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ AIå¿œç­”ã‚’ä½“é¨“ã§ãã¾ã™ã€‚">
<meta property="og:title" content="ãŠå•ã„åˆã‚ã› | AIè‡ªå‹•è¿”ä¿¡ãƒ‡ãƒ¢">
<meta property="og:description" content="AIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã«ã‚ˆã‚‹ãŠå•ã„åˆã‚ã›è‡ªå‹•è¿”ä¿¡ãƒ‡ãƒ¢ã€‚ã‚¹ãƒ†ãƒƒãƒ—å½¢å¼ã®ãƒ•ã‚©ãƒ¼ãƒ ã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ AIå¿œç­”ã‚’ä½“é¨“ã§ãã¾ã™ã€‚">
<meta property="og:type" content="website">
<meta property="og:url" content="https://portfolio.logence.co.jp/demos/contact-bot/">
<meta property="og:image" content="https://portfolio.logence.co.jp/img/ogp.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="ãŠå•ã„åˆã‚ã› | AIè‡ªå‹•è¿”ä¿¡ãƒ‡ãƒ¢">
<meta name="twitter:description" content="AIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã«ã‚ˆã‚‹ãŠå•ã„åˆã‚ã›è‡ªå‹•è¿”ä¿¡ãƒ‡ãƒ¢ã€‚ã‚¹ãƒ†ãƒƒãƒ—å½¢å¼ã®ãƒ•ã‚©ãƒ¼ãƒ ã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ AIå¿œç­”ã‚’ä½“é¨“ã§ãã¾ã™ã€‚">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Shippori+Mincho:wght@400;500;600;700&family=Zen+Kaku+Gothic+New:wght@400;500;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --accent: #059669;
  --accent-hover: #047857;
  --accent-light: #D1FAE5;
  --accent-glow: rgba(5, 150, 105, 0.15);
  --text-primary: #111827;
  --text-secondary: #6B7280;
  --text-muted: #9CA3AF;
  --bg: #FFFFFF;
  --bg-subtle: #F9FAFB;
  --chat-ai: #F3F4F6;
  --chat-user: #059669;
  --border: #E5E7EB;
  --radius: 8px;
  --radius-sm: 4px;
  --radius-lg: 12px;
  --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
  --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.07), 0 2px 4px -2px rgba(0,0,0,0.05);
  --shadow-lg: 0 10px 25px -5px rgba(0,0,0,0.08), 0 8px 10px -6px rgba(0,0,0,0.04);
  --brand-dark: #064E3B;
  --brand-medium: #065F46;
  --font-head: 'Shippori Mincho', serif;
  --font-body: 'Zen Kaku Gothic New', sans-serif;
  --font-num: 'DM Sans', sans-serif;
}

html { height: 100%; }
body {
  font-family: var(--font-body);
  background: var(--bg-subtle);
  color: var(--text-primary);
  height: 100%;
  overflow: hidden;
  -webkit-font-smoothing: antialiased;
}

/* â”€â”€ Header â”€â”€ */
.header {
  position: fixed; top: 0; left: 0; right: 0; z-index: 100;
  height: 56px;
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 24px;
  background: rgba(255,255,255,0.82);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border-bottom: 1px solid rgba(229,231,235,0.6);
}
.header-back {
  display: flex; align-items: center; gap: 6px;
  color: var(--text-secondary);
  text-decoration: none;
  font-size: 14px; font-weight: 500;
  transition: color 0.2s;
}
.header-back:hover { color: var(--accent); }
.header-back svg { width: 18px; height: 18px; }
.header-badge {
  display: flex; align-items: center; gap: 6px;
  font-size: 12px; font-weight: 700; color: var(--accent);
  background: var(--accent-light);
  padding: 5px 14px; border-radius: 20px;
  letter-spacing: 0.02em;
}
.header-badge svg { width: 14px; height: 14px; }

/* â”€â”€ Progress Bar (thin accent line, kept for JS) â”€â”€ */
.progress-wrap {
  position: fixed; top: 56px; left: 0; right: 0; z-index: 99;
  height: 3px; background: transparent;
}
.progress-bar {
  height: 100%; width: 0%;
  background: linear-gradient(90deg, var(--accent), #34D399);
  transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  border-radius: 0 2px 2px 0;
}

/* â”€â”€ Two-Column Layout â”€â”€ */
.layout {
  display: flex;
  height: 100vh;
  padding-top: 56px;
}

/* â”€â”€ Brand Panel (Left) â”€â”€ */
.brand-panel {
  width: 420px;
  flex-shrink: 0;
  background: linear-gradient(160deg, #064E3B 0%, #065F46 40%, #047857 100%);
  color: #fff;
  position: relative;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}
.brand-panel::before {
  content: '';
  position: absolute;
  width: 340px; height: 340px;
  border-radius: 50%;
  background: rgba(255,255,255,0.04);
  top: -80px; right: -100px;
  pointer-events: none;
}
.brand-panel::after {
  content: '';
  position: absolute;
  width: 240px; height: 240px;
  border-radius: 50%;
  background: rgba(255,255,255,0.03);
  bottom: 60px; left: -80px;
  pointer-events: none;
}
.brand-content {
  position: relative; z-index: 1;
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  padding: 48px 40px;
  gap: 40px;
}
.brand-icon {
  width: 56px; height: 56px;
  background: rgba(255,255,255,0.12);
  border-radius: var(--radius-lg);
  display: flex; align-items: center; justify-content: center;
  margin-bottom: 8px;
  backdrop-filter: blur(8px);
}
.brand-icon svg { width: 28px; height: 28px; color: #34D399; }
.brand-title {
  font-family: var(--font-head);
  font-size: 1.6rem;
  font-weight: 600;
  line-height: 1.5;
  letter-spacing: 0.03em;
  margin-bottom: 8px;
}
.brand-desc {
  font-size: 14px;
  line-height: 1.8;
  color: rgba(255,255,255,0.7);
}
.brand-features {
  display: flex;
  flex-direction: column;
  gap: 20px;
}
.feature-item {
  display: flex;
  align-items: center;
  gap: 16px;
}
.feature-icon {
  width: 40px; height: 40px;
  background: rgba(255,255,255,0.08);
  border-radius: var(--radius);
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
}
.feature-icon svg { width: 20px; height: 20px; color: #6EE7B7; }
.feature-num {
  font-family: var(--font-num);
  font-size: 1.15rem;
  font-weight: 700;
  letter-spacing: -0.01em;
}
.feature-label {
  font-size: 13px;
  color: rgba(255,255,255,0.55);
  margin-top: 1px;
}
.brand-testimonial {
  background: rgba(255,255,255,0.07);
  border-radius: var(--radius-lg);
  padding: 24px;
  border: 1px solid rgba(255,255,255,0.08);
  backdrop-filter: blur(4px);
}
.brand-testimonial blockquote {
  font-size: 13.5px;
  line-height: 1.85;
  color: rgba(255,255,255,0.8);
  font-style: normal;
  margin-bottom: 16px;
}
.testimonial-author {
  display: flex;
  align-items: center;
  gap: 10px;
}
.testimonial-avatar {
  width: 32px; height: 32px;
  background: rgba(255,255,255,0.15);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 13px; font-weight: 600;
}
.testimonial-name {
  font-size: 13px;
  font-weight: 600;
}
.testimonial-role {
  font-size: 12px;
  color: rgba(255,255,255,0.45);
}

/* â”€â”€ Mobile Banner (hidden on desktop) â”€â”€ */
.mobile-banner {
  display: none;
  align-items: center;
  justify-content: center;
  gap: 12px;
  padding: 10px 16px;
  background: linear-gradient(90deg, #064E3B, #065F46);
  color: #fff;
  font-size: 12px;
  font-weight: 600;
}
.mobile-banner .sep { color: rgba(255,255,255,0.3); }

/* â”€â”€ Form Panel (Right) â”€â”€ */
.form-panel {
  flex: 1;
  display: flex;
  flex-direction: column;
  position: relative;
  overflow: hidden;
  background: var(--bg);
  box-shadow: -2px 0 20px rgba(0,0,0,0.04);
}

/* â”€â”€ Step Dots â”€â”€ */
.step-dots-wrap {
  padding: 24px 32px 0;
  flex-shrink: 0;
}
.step-dots {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0;
  max-width: 480px;
  margin: 0 auto;
}
.step-dot {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  flex-shrink: 0;
}
.dot-circle {
  width: 36px; height: 36px;
  border-radius: 50%;
  border: 2px solid var(--border);
  display: flex; align-items: center; justify-content: center;
  background: var(--bg);
  transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
}
.dot-circle .dot-icon {
  width: 16px; height: 16px;
  color: var(--text-muted);
  transition: all 0.3s;
}
.dot-circle .dot-check {
  width: 16px; height: 16px;
  color: #fff;
  position: absolute;
  opacity: 0;
  transform: scale(0.5);
  transition: all 0.3s;
}
.dot-label {
  font-size: 11px;
  font-weight: 600;
  color: var(--text-muted);
  transition: color 0.3s;
  letter-spacing: 0.02em;
}
/* Current step */
.step-dot.current .dot-circle {
  border-color: var(--accent);
  background: var(--accent-light);
  box-shadow: 0 0 0 4px var(--accent-glow);
}
.step-dot.current .dot-circle .dot-icon { color: var(--accent); }
.step-dot.current .dot-label { color: var(--accent); }
/* Completed step */
.step-dot.completed .dot-circle {
  border-color: var(--accent);
  background: var(--accent);
}
.step-dot.completed .dot-circle .dot-icon { opacity: 0; transform: scale(0.5); }
.step-dot.completed .dot-circle .dot-check { opacity: 1; transform: scale(1); }
.step-dot.completed .dot-label { color: var(--accent); }
/* Connector line */
.dot-connector {
  flex: 1;
  height: 2px;
  background: var(--border);
  margin: 0 4px;
  margin-bottom: 24px;
  border-radius: 1px;
  position: relative;
  min-width: 32px;
  overflow: hidden;
}
.dot-connector::after {
  content: '';
  position: absolute;
  top: 0; left: 0; bottom: 0;
  width: 0%;
  background: var(--accent);
  border-radius: 1px;
  transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}
.dot-connector.filled::after { width: 100%; }

/* â”€â”€ Steps Area â”€â”€ */
.steps-area {
  flex: 1;
  position: relative;
  overflow: hidden;
}

/* â”€â”€ Step Screens â”€â”€ */
.step {
  position: absolute; top: 0; left: 0; right: 0; bottom: 0;
  display: flex; flex-direction: column; justify-content: center; align-items: center;
  padding: 20px 32px 80px;
  opacity: 0; visibility: hidden;
  transition: opacity 0.45s ease, transform 0.45s ease, visibility 0s 0.45s;
  transform: translateY(20px);
}
.step.active {
  opacity: 1; visibility: visible;
  transform: translateY(0);
  transition: opacity 0.45s ease, transform 0.45s ease, visibility 0s 0s;
}

.step-inner {
  width: 100%; max-width: 520px;
}
.step-number {
  display: inline-flex; align-items: center; gap: 6px;
  font-size: 13px; font-weight: 700; color: var(--accent);
  letter-spacing: 0.05em;
  margin-bottom: 16px;
  font-family: var(--font-num);
}
.step-number span {
  display: inline-flex; align-items: center; justify-content: center;
  width: 22px; height: 22px;
  background: var(--accent);
  color: #fff;
  font-size: 12px; font-weight: 700;
  border-radius: var(--radius-sm);
  font-family: var(--font-num);
}
.step-question {
  font-family: var(--font-head);
  font-size: 1.75rem; font-weight: 600; line-height: 1.5;
  color: var(--text-primary);
  margin-bottom: 32px;
  letter-spacing: .03em;
}
.step-sub {
  font-size: 14px; color: var(--text-muted);
  margin-top: -20px; margin-bottom: 28px;
}

/* â”€â”€ Inputs â”€â”€ */
.input-text {
  width: 100%;
  padding: 16px 0;
  font-size: 20px; font-weight: 500;
  font-family: var(--font-body);
  color: var(--text-primary);
  background: transparent;
  border: none; border-bottom: 2px solid var(--border);
  outline: none;
  transition: border-color 0.3s;
  background-image: linear-gradient(var(--accent), var(--accent));
  background-size: 0% 2px;
  background-position: center bottom;
  background-repeat: no-repeat;
}
.input-text:focus {
  border-bottom-color: transparent;
  background-size: 100% 2px;
}
.input-text::placeholder { color: var(--text-muted); }

textarea.input-text {
  resize: vertical;
  min-height: 120px;
  border: 2px solid var(--border);
  border-radius: var(--radius);
  padding: 16px;
  font-size: 16px;
  line-height: 1.7;
  background-image: none;
  transition: border-color 0.3s, box-shadow 0.3s;
}
textarea.input-text:focus {
  border-color: var(--accent);
  background-size: 0;
  box-shadow: 0 0 0 3px var(--accent-glow);
}

.input-error {
  font-size: 13px; color: #EF4444; margin-top: 8px;
  display: none; align-items: center; gap: 4px;
}
.input-error.show { display: flex; }
.input-error svg { width: 14px; height: 14px; flex-shrink: 0; }

/* â”€â”€ Option Buttons â”€â”€ */
.options-grid {
  display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
}
.option-btn {
  display: flex; align-items: center; justify-content: center;
  padding: 18px 16px;
  font-size: 15px; font-weight: 700;
  font-family: var(--font-body);
  color: var(--text-primary);
  background: var(--bg);
  border: 2px solid var(--border);
  border-radius: var(--radius);
  cursor: pointer;
  transition: all 0.25s ease;
  text-align: center;
  line-height: 1.4;
  box-shadow: var(--shadow-sm);
}
.option-btn:hover {
  border-color: var(--accent);
  background: var(--accent-light);
  color: var(--accent-hover);
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}
.option-btn.selected {
  border-color: var(--accent);
  background: var(--accent);
  color: #fff;
  box-shadow: 0 4px 12px rgba(5, 150, 105, 0.25);
}

/* â”€â”€ Next Button â”€â”€ */
.next-btn {
  display: inline-flex; align-items: center; gap: 8px;
  margin-top: 32px;
  padding: 14px 32px;
  font-size: 15px; font-weight: 600;
  font-family: var(--font-body);
  color: #fff;
  background: var(--accent);
  border: none; border-radius: var(--radius);
  cursor: pointer;
  transition: all 0.25s ease;
  box-shadow: 0 2px 8px rgba(5, 150, 105, 0.2);
}
.next-btn:hover {
  background: var(--accent-hover);
  transform: translateY(-1px);
  box-shadow: 0 4px 16px rgba(5, 150, 105, 0.3);
}
.next-btn:active {
  transform: translateY(0);
  box-shadow: 0 1px 4px rgba(5, 150, 105, 0.2);
}
.next-btn svg { width: 16px; height: 16px; }
.next-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; box-shadow: none; }

.enter-hint {
  display: flex; align-items: center; gap: 6px;
  margin-top: 12px;
  font-size: 13px; color: var(--text-muted);
}
.enter-hint kbd {
  padding: 2px 8px;
  background: var(--bg-subtle);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  font-size: 12px; font-family: var(--font-num);
  font-weight: 500;
}

/* â”€â”€ Confirm Screen â”€â”€ */
.confirm-card {
  width: 100%; max-width: 520px;
}
.confirm-title {
  font-family: var(--font-head);
  font-size: 1.35rem; font-weight: 600;
  margin-bottom: 8px;
  letter-spacing: .02em;
}
.confirm-sub {
  font-size: 14px; color: var(--text-secondary);
  margin-bottom: 32px;
}
.confirm-items {
  display: flex; flex-direction: column; gap: 0;
  background: var(--bg-subtle);
  border-radius: var(--radius-lg);
  overflow: hidden;
  border: 1px solid var(--border);
  box-shadow: var(--shadow-sm);
}
.confirm-item {
  padding: 16px 20px;
  border-bottom: 1px solid var(--border);
}
.confirm-item:last-child { border-bottom: none; }
.confirm-label {
  font-size: 12px; font-weight: 700; color: var(--text-muted);
  letter-spacing: 0.05em;
  margin-bottom: 4px;
}
.confirm-value {
  font-size: 15px; font-weight: 500; color: var(--text-primary);
  line-height: 1.5;
  word-break: break-word;
}
.confirm-actions {
  display: flex; gap: 12px; margin-top: 24px;
}
.btn-secondary {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 14px 28px;
  font-size: 15px; font-weight: 600;
  font-family: var(--font-body);
  color: var(--text-secondary);
  background: var(--bg);
  border: 2px solid var(--border);
  border-radius: var(--radius);
  cursor: pointer;
  transition: all 0.2s;
}
.btn-secondary:hover { border-color: var(--text-muted); color: var(--text-primary); transform: translateY(-1px); }
.btn-primary {
  display: inline-flex; align-items: center; gap: 8px;
  padding: 14px 36px;
  font-size: 15px; font-weight: 600;
  font-family: var(--font-body);
  color: #fff;
  background: var(--accent);
  border: none; border-radius: var(--radius);
  cursor: pointer;
  transition: all 0.25s ease;
  box-shadow: 0 2px 8px rgba(5, 150, 105, 0.2);
}
.btn-primary:hover {
  background: var(--accent-hover);
  transform: translateY(-1px);
  box-shadow: 0 4px 16px rgba(5, 150, 105, 0.3);
}
.btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
.btn-primary svg { width: 16px; height: 16px; }

/* â”€â”€ Chat Screen â”€â”€ */
.chat-screen {
  position: absolute; top: 0; left: 0; right: 0; bottom: 0;
  display: flex; flex-direction: column;
  opacity: 0; visibility: hidden;
  transition: opacity 0.4s ease, visibility 0s 0.4s;
  z-index: 10;
  background: var(--bg);
}
.chat-screen.active {
  opacity: 1; visibility: visible;
  transition: opacity 0.4s ease, visibility 0s 0s;
}
.chat-messages {
  flex: 1; overflow-y: auto;
  padding: 24px 24px 16px;
  display: flex; flex-direction: column; gap: 16px;
  scroll-behavior: smooth;
  background: linear-gradient(180deg, var(--bg-subtle) 0%, var(--bg) 40%);
}

/* Chat bubbles */
.chat-bubble-wrap {
  display: flex; gap: 10px;
  max-width: 85%;
  animation: bubbleIn 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
}
.chat-bubble-wrap.user {
  align-self: flex-end;
  flex-direction: row-reverse;
}
@keyframes bubbleIn {
  from { opacity: 0; transform: translateY(12px) scale(0.97); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}
.chat-avatar {
  width: 34px; height: 34px;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 14px;
  flex-shrink: 0;
}
.chat-avatar.ai {
  background: var(--accent-light);
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23059669'%3E%3Cpath d='M12 2L14.09 8.26L20 12L14.09 15.74L12 22L9.91 15.74L4 12L9.91 8.26L12 2Z'/%3E%3C/svg%3E");
  background-position: center;
  background-repeat: no-repeat;
  background-size: 18px;
}
.chat-avatar.human {
  background: var(--chat-user); color: #fff; font-size: 12px;
  font-weight: 600;
}
.chat-bubble {
  padding: 14px 18px;
  font-size: 15px; line-height: 1.75;
  word-break: break-word;
  position: relative;
}
.chat-bubble.ai {
  background: var(--chat-ai);
  color: var(--text-primary);
  border-radius: 4px var(--radius-lg) var(--radius-lg) var(--radius-lg);
  border-left: 3px solid var(--accent);
  box-shadow: var(--shadow-sm);
}
.chat-bubble.user {
  background: linear-gradient(135deg, var(--chat-user), #047857);
  color: #fff;
  border-radius: var(--radius-lg) 4px var(--radius-lg) var(--radius-lg);
  box-shadow: 0 2px 8px rgba(5, 150, 105, 0.2);
}
.chat-bubble .cursor {
  display: inline-block;
  width: 2px; height: 1em;
  background: var(--accent);
  animation: blink 0.8s infinite;
  vertical-align: text-bottom;
  margin-left: 1px;
}
@keyframes blink { 0%,49% { opacity: 1; } 50%,100% { opacity: 0; } }

.typing-indicator {
  display: flex; gap: 5px; padding: 4px 0;
}
.typing-indicator span {
  width: 7px; height: 7px;
  background: var(--text-muted);
  border-radius: 50%;
  animation: typingDot 1.4s infinite;
}
.typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
.typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
@keyframes typingDot {
  0%,44% { transform: translateY(0); opacity: 0.4; }
  28% { transform: translateY(-5px); opacity: 1; }
}

.system-msg {
  text-align: center;
  font-size: 13px; color: var(--text-muted);
  padding: 8px 0;
}
.system-msg .checkmark {
  display: inline-flex; align-items: center; justify-content: center;
  width: 40px; height: 40px;
  background: var(--accent-light);
  border-radius: 50%;
  margin-bottom: 8px;
  box-shadow: 0 0 0 6px rgba(5, 150, 105, 0.08);
}
.system-msg .checkmark svg { color: var(--accent); width: 20px; height: 20px; }

/* â”€â”€ Chat Input â”€â”€ */
.chat-input-wrap {
  padding: 12px 16px 24px;
  background: var(--bg);
  border-top: 1px solid var(--border);
}
.chat-input-inner {
  display: flex; gap: 8px; align-items: flex-end;
  max-width: 680px; margin: 0 auto;
}
.chat-input {
  flex: 1;
  padding: 12px 16px;
  font-size: 15px; font-family: var(--font-body);
  color: var(--text-primary);
  background: var(--bg-subtle);
  border: 1.5px solid var(--border);
  border-radius: var(--radius-lg);
  outline: none;
  resize: none;
  max-height: 120px;
  transition: border-color 0.2s, box-shadow 0.2s;
}
.chat-input:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-glow);
}
.chat-input::placeholder { color: var(--text-muted); }
.chat-send-btn {
  width: 44px; height: 44px;
  display: flex; align-items: center; justify-content: center;
  background: var(--accent);
  color: #fff;
  border: none; border-radius: 50%;
  cursor: pointer;
  transition: all 0.2s;
  flex-shrink: 0;
  box-shadow: 0 2px 8px rgba(5, 150, 105, 0.25);
}
.chat-send-btn:hover {
  background: var(--accent-hover);
  transform: scale(1.05);
}
.chat-send-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; box-shadow: none; }
.chat-send-btn svg { width: 20px; height: 20px; }

/* â”€â”€ Responsive â”€â”€ */
@media (max-width: 960px) {
  .brand-panel { display: none; }
  .mobile-banner { display: flex; }
  .form-panel { box-shadow: none; }
}
@media (max-width: 640px) {
  .step { padding: 16px 20px 60px; }
  .step-question { font-size: 1.4rem; }
  .input-text { font-size: 18px; }
  .options-grid { grid-template-columns: 1fr; }
  .confirm-actions { flex-direction: column; }
  .confirm-actions button { width: 100%; justify-content: center; }
  .header { padding: 0 16px; }
  .chat-messages { padding: 16px 16px 12px; }
  .chat-bubble-wrap { max-width: 92%; }
  .step-dots-wrap { padding: 16px 16px 0; }
  .dot-label { display: none; }
  .dot-circle { width: 30px; height: 30px; }
  .dot-connector { margin-bottom: 0; min-width: 24px; }
}
</style>
</head>
<body>

<!-- Header -->
<header class="header">
  <a href="/" class="header-back">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"/><path d="M12 19l-7-7 7-7"/></svg>
    â† ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã«æˆ»ã‚‹
  </a>
  <div class="header-badge">
    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L14.09 8.26L20 12L14.09 15.74L12 22L9.91 15.74L4 12L9.91 8.26L12 2Z"/></svg>
    AI è‡ªå‹•è¿”ä¿¡ãƒ‡ãƒ¢
  </div>
</header>

<!-- Progress (kept for JS compatibility) -->
<div class="progress-wrap"><div class="progress-bar" id="progressBar"></div></div>

<!-- Layout -->
<div class="layout">

  <!-- Left Brand Panel -->
  <aside class="brand-panel">
    <div class="brand-content">
      <div>
        <div class="brand-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2L14.09 8.26L20 12L14.09 15.74L12 22L9.91 15.74L4 12L9.91 8.26L12 2Z" fill="currentColor" stroke="none"/>
          </svg>
        </div>
        <h1 class="brand-title">AI ãŠå•ã„åˆã‚ã›<br>ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</h1>
        <p class="brand-desc">AIãŒ24æ™‚é–“ã€ãŠå®¢æ§˜ã®ãŠå•ã„åˆã‚ã›ã«<br>å³åº§ã«å¯¾å¿œã„ãŸã—ã¾ã™ã€‚</p>
      </div>

      <div class="brand-features">
        <div class="feature-item">
          <div class="feature-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          </div>
          <div>
            <div class="feature-num">24æ™‚é–“</div>
            <div class="feature-label">å¹´ä¸­ç„¡ä¼‘ã§å³åº§ã«å¯¾å¿œ</div>
          </div>
        </div>
        <div class="feature-item">
          <div class="feature-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
          </div>
          <div>
            <div class="feature-num">30ç§’</div>
            <div class="feature-label">å¹³å‡å¿œç­”æ™‚é–“</div>
          </div>
        </div>
        <div class="feature-item">
          <div class="feature-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
          </div>
          <div>
            <div class="feature-num">98%</div>
            <div class="feature-label">ãŠå®¢æ§˜æº€è¶³åº¦</div>
          </div>
        </div>
      </div>

      <div class="brand-testimonial">
        <blockquote>"å•ã„åˆã‚ã›ã‹ã‚‰æ•°ç§’ã§çš„ç¢ºãªå›ç­”ãŒè¿”ã£ã¦ãã¦é©šãã¾ã—ãŸã€‚æ·±å¤œã®å•ã„åˆã‚ã›ã«ã‚‚å¯¾å¿œã—ã¦ã„ãŸã ã‘ã‚‹ã®ã¯æœ¬å½“ã«åŠ©ã‹ã‚Šã¾ã™ã€‚"</blockquote>
        <div class="testimonial-author">
          <div class="testimonial-avatar">å±±</div>
          <div>
            <div class="testimonial-name">å±±ç”° å¤ªéƒ æ§˜</div>
            <div class="testimonial-role">è£½é€ æ¥­ / æ±äº¬éƒ½</div>
          </div>
        </div>
      </div>
    </div>
  </aside>

  <!-- Right Form Panel -->
  <div class="form-panel">

    <!-- Mobile Banner -->
    <div class="mobile-banner">
      <span>âš¡ 24æ™‚é–“å¯¾å¿œ</span>
      <span class="sep">Â·</span>
      <span>ğŸš€ 30ç§’å¿œç­”</span>
      <span class="sep">Â·</span>
      <span>â¤ï¸ 98%æº€è¶³åº¦</span>
    </div>

    <!-- Step Progress Dots -->
    <div class="step-dots-wrap" id="stepDotsWrap">
      <div class="step-dots">
        <div class="step-dot current" data-dot="1">
          <div class="dot-circle">
            <svg class="dot-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            <svg class="dot-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
          </div>
          <span class="dot-label">ãŠåå‰</span>
        </div>
        <div class="dot-connector"></div>
        <div class="step-dot" data-dot="2">
          <div class="dot-circle">
            <svg class="dot-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
            <svg class="dot-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
          </div>
          <span class="dot-label">ãƒ¡ãƒ¼ãƒ«</span>
        </div>
        <div class="dot-connector"></div>
        <div class="step-dot" data-dot="3">
          <div class="dot-circle">
            <svg class="dot-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
            <svg class="dot-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
          </div>
          <span class="dot-label">ç¨®åˆ¥</span>
        </div>
        <div class="dot-connector"></div>
        <div class="step-dot" data-dot="4">
          <div class="dot-circle">
            <svg class="dot-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
            <svg class="dot-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
          </div>
          <span class="dot-label">å†…å®¹</span>
        </div>
      </div>
    </div>

    <!-- Steps Area -->
    <div class="steps-area">

      <!-- STEP 1: Name -->
      <div class="step active" data-step="1">
        <div class="step-inner">
          <div class="step-number"><span>1</span> / 4</div>
          <h2 class="step-question">ãŠåå‰ã‚’<br>æ•™ãˆã¦ãã ã•ã„</h2>
          <input type="text" class="input-text" id="inputName" placeholder="ä¾‹ï¼šç”°ä¸­ å¤ªéƒ" autocomplete="name" autofocus>
          <div class="input-error" id="errorName">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
            ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
          </div>
          <button class="next-btn" id="btnNext1" onclick="nextStep(1)">
            æ¬¡ã¸
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5l7 7-7 7"/></svg>
          </button>
          <div class="enter-hint"><kbd>Enter â†µ</kbd> ã§ã‚‚é€²ã‚ã¾ã™</div>
        </div>
      </div>

      <!-- STEP 2: Email -->
      <div class="step" data-step="2">
        <div class="step-inner">
          <div class="step-number"><span>2</span> / 4</div>
          <h2 class="step-question">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’<br>å…¥åŠ›ã—ã¦ãã ã•ã„</h2>
          <p class="step-sub">è¿”ä¿¡å…ˆã¨ã—ã¦ä½¿ç”¨ã—ã¾ã™</p>
          <input type="email" class="input-text" id="inputEmail" placeholder="ä¾‹ï¼štaro@example.com" autocomplete="email">
          <div class="input-error" id="errorEmail">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
            æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
          </div>
          <button class="next-btn" id="btnNext2" onclick="nextStep(2)">
            æ¬¡ã¸
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5l7 7-7 7"/></svg>
          </button>
          <div class="enter-hint"><kbd>Enter â†µ</kbd> ã§ã‚‚é€²ã‚ã¾ã™</div>
        </div>
      </div>

      <!-- STEP 3: Category -->
      <div class="step" data-step="3">
        <div class="step-inner">
          <div class="step-number"><span>3</span> / 4</div>
          <h2 class="step-question">ãŠå•ã„åˆã‚ã›ã®ç¨®é¡ã‚’<br>é¸ã‚“ã§ãã ã•ã„</h2>
          <div class="options-grid">
            <button class="option-btn" onclick="selectCategory(this, 'ã‚µãƒ¼ãƒ“ã‚¹ã«ã¤ã„ã¦')">ã‚µãƒ¼ãƒ“ã‚¹ã«ã¤ã„ã¦</button>
            <button class="option-btn" onclick="selectCategory(this, 'æ–™é‡‘ã«ã¤ã„ã¦')">æ–™é‡‘ã«ã¤ã„ã¦</button>
            <button class="option-btn" onclick="selectCategory(this, 'å°å…¥ç›¸è«‡')">å°å…¥ç›¸è«‡</button>
            <button class="option-btn" onclick="selectCategory(this, 'ãã®ä»–')">ãã®ä»–</button>
          </div>
        </div>
      </div>

      <!-- STEP 4: Message -->
      <div class="step" data-step="4">
        <div class="step-inner">
          <div class="step-number"><span>4</span> / 4</div>
          <h2 class="step-question">ãŠå•ã„åˆã‚ã›å†…å®¹ã‚’<br>ãŠèã‹ã›ãã ã•ã„</h2>
          <textarea class="input-text" id="inputMessage" placeholder="å…·ä½“çš„ãªå†…å®¹ã‚’ãŠæ›¸ããã ã•ã„..." rows="5"></textarea>
          <div class="input-error" id="errorMessage">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
            ãŠå•ã„åˆã‚ã›å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
          </div>
          <button class="next-btn" id="btnNext4" onclick="nextStep(4)">
            ç¢ºèªã¸é€²ã‚€
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5l7 7-7 7"/></svg>
          </button>
          <div class="enter-hint"><kbd>Ctrl + Enter</kbd> ã§ç¢ºèªç”»é¢ã¸</div>
        </div>
      </div>

      <!-- STEP 5: Confirm -->
      <div class="step" data-step="5">
        <div class="confirm-card">
          <h2 class="confirm-title">å…¥åŠ›å†…å®¹ã®ç¢ºèª</h2>
          <p class="confirm-sub">ä»¥ä¸‹ã®å†…å®¹ã§é€ä¿¡ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ</p>
          <div class="confirm-items">
            <div class="confirm-item">
              <div class="confirm-label">ãŠåå‰</div>
              <div class="confirm-value" id="confirmName"></div>
            </div>
            <div class="confirm-item">
              <div class="confirm-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</div>
              <div class="confirm-value" id="confirmEmail"></div>
            </div>
            <div class="confirm-item">
              <div class="confirm-label">ãŠå•ã„åˆã‚ã›ç¨®åˆ¥</div>
              <div class="confirm-value" id="confirmCategory"></div>
            </div>
            <div class="confirm-item">
              <div class="confirm-label">ãŠå•ã„åˆã‚ã›å†…å®¹</div>
              <div class="confirm-value" id="confirmMessage"></div>
            </div>
          </div>
          <div class="confirm-actions">
            <button class="btn-secondary" onclick="goToStep(1)">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"/><path d="M12 19l-7-7 7-7"/></svg>
              ä¿®æ­£ã™ã‚‹
            </button>
            <button class="btn-primary" id="btnSubmit" onclick="submitForm()">
              é€ä¿¡ã™ã‚‹
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 2L11 13"/><path d="M22 2l-7 20-4-9-9-4 20-7z"/></svg>
            </button>
          </div>
        </div>
      </div>

    </div><!-- /steps-area -->

    <!-- Chat Screen -->
    <div class="chat-screen" id="chatScreen">
      <div class="chat-messages" id="chatMessages"></div>
      <div class="chat-input-wrap">
        <div class="chat-input-inner">
          <textarea class="chat-input" id="chatInput" placeholder="ã•ã‚‰ã«è³ªå•ãŒã‚ã‚Œã°ã©ã†ã..." rows="1" onkeydown="handleChatKey(event)"></textarea>
          <button class="chat-send-btn" id="chatSendBtn" onclick="sendChatMessage()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 2L11 13"/><path d="M22 2l-7 20-4-9-9-4 20-7z"/></svg>
          </button>
        </div>
      </div>
    </div>

  </div><!-- /form-panel -->

</div><!-- /layout -->

<script>
// â”€â”€ Config â”€â”€
const API_URL = 'https://portfolio.logence.co.jp/api/chat';
const API_KEY = 'app-LAVJccnHNJd75uEQE1V7FnSP';

// â”€â”€ State â”€â”€
let currentStep = 1;
let formData = { name: '', email: '', category: '', message: '' };
let conversationId = '';
let isTyping = false;

// â”€â”€ Progress â”€â”€
function updateProgress() {
  const pct = currentStep <= 4 ? ((currentStep - 1) / 4) * 100 : 100;
  document.getElementById('progressBar').style.width = pct + '%';
  // Update step dots
  document.querySelectorAll('.step-dot').forEach(dot => {
    const s = parseInt(dot.dataset.dot);
    dot.classList.remove('current', 'completed');
    if (currentStep === 5 || s < currentStep) dot.classList.add('completed');
    else if (s === currentStep) dot.classList.add('current');
  });
  document.querySelectorAll('.dot-connector').forEach((line, i) => {
    line.classList.toggle('filled', currentStep === 5 || i < currentStep - 1);
  });
}

// â”€â”€ Step Navigation â”€â”€
function goToStep(step) {
  document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
  currentStep = step;
  const target = document.querySelector(`.step[data-step="${step}"]`);
  if (target) {
    target.classList.add('active');
    setTimeout(() => {
      const input = target.querySelector('input, textarea');
      if (input) input.focus();
    }, 100);
  }
  updateProgress();
}

function nextStep(step) {
  if (!validateStep(step)) return;
  saveStepData(step);

  if (step === 4) {
    showConfirm();
    goToStep(5);
  } else {
    goToStep(step + 1);
  }
}

// â”€â”€ Validation â”€â”€
function validateStep(step) {
  if (step === 1) {
    const v = document.getElementById('inputName').value.trim();
    const err = document.getElementById('errorName');
    if (!v) { err.classList.add('show'); return false; }
    err.classList.remove('show');
    return true;
  }
  if (step === 2) {
    const v = document.getElementById('inputEmail').value.trim();
    const err = document.getElementById('errorEmail');
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!v || !re.test(v)) { err.classList.add('show'); return false; }
    err.classList.remove('show');
    return true;
  }
  if (step === 3) {
    return !!formData.category;
  }
  if (step === 4) {
    const v = document.getElementById('inputMessage').value.trim();
    const err = document.getElementById('errorMessage');
    if (!v) { err.classList.add('show'); return false; }
    err.classList.remove('show');
    return true;
  }
  return true;
}

function saveStepData(step) {
  if (step === 1) formData.name = document.getElementById('inputName').value.trim();
  if (step === 2) formData.email = document.getElementById('inputEmail').value.trim();
  if (step === 4) formData.message = document.getElementById('inputMessage').value.trim();
}

// â”€â”€ Category Select â”€â”€
function selectCategory(btn, value) {
  document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  formData.category = value;
  setTimeout(() => nextStep(3), 250);
}

// â”€â”€ Confirm â”€â”€
function showConfirm() {
  document.getElementById('confirmName').textContent = formData.name;
  document.getElementById('confirmEmail').textContent = formData.email;
  document.getElementById('confirmCategory').textContent = formData.category;
  document.getElementById('confirmMessage').textContent = formData.message;
}

// â”€â”€ Submit â”€â”€
async function submitForm() {
  const btn = document.getElementById('btnSubmit');
  btn.disabled = true;
  btn.textContent = 'é€ä¿¡ã—ã¦ã„ã¾ã™...';

  document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
  document.getElementById('chatScreen').classList.add('active');
  document.getElementById('progressBar').style.width = '100%';
  document.getElementById('stepDotsWrap').style.display = 'none';

  addSystemMessage();

  const query = `ã€ãŠå•ã„åˆã‚ã›ã€‘\nãŠåå‰: ${formData.name}\nãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹: ${formData.email}\nç¨®åˆ¥: ${formData.category}\n\n${formData.message}`;
  addUserBubble(formData.message);

  await callDifyAPI(query);
}

// â”€â”€ Chat UI â”€â”€
function addSystemMessage() {
  const wrap = document.getElementById('chatMessages');
  const div = document.createElement('div');
  div.className = 'system-msg';
  div.innerHTML = `
    <div class="checkmark"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5"/></svg></div>
    <div style="font-weight:600;color:var(--text-primary);font-size:15px;margin-bottom:2px">ãŠå•ã„åˆã‚ã›ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸ</div>
    <div>${formData.name} ã•ã‚“ã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚AIãŒå›ç­”ã‚’æº–å‚™ã—ã¦ã„ã¾ã™...</div>
  `;
  wrap.appendChild(div);
  scrollChat();
}

function addUserBubble(text) {
  const wrap = document.getElementById('chatMessages');
  const div = document.createElement('div');
  div.className = 'chat-bubble-wrap user';
  div.innerHTML = `
    <div class="chat-avatar human">You</div>
    <div class="chat-bubble user">${escapeHtml(text)}</div>
  `;
  wrap.appendChild(div);
  scrollChat();
}

function addTypingIndicator() {
  const wrap = document.getElementById('chatMessages');
  const div = document.createElement('div');
  div.className = 'chat-bubble-wrap';
  div.id = 'typingIndicator';
  div.innerHTML = `
    <div class="chat-avatar ai"></div>
    <div class="chat-bubble ai"><div class="typing-indicator"><span></span><span></span><span></span></div></div>
  `;
  wrap.appendChild(div);
  scrollChat();
}

function removeTypingIndicator() {
  const el = document.getElementById('typingIndicator');
  if (el) el.remove();
}

async function addAIBubble(text) {
  removeTypingIndicator();
  const wrap = document.getElementById('chatMessages');
  const div = document.createElement('div');
  div.className = 'chat-bubble-wrap';
  const bubble = document.createElement('div');
  bubble.className = 'chat-bubble ai';
  div.innerHTML = `<div class="chat-avatar ai"></div>`;
  div.appendChild(bubble);
  wrap.appendChild(div);

  await typeText(bubble, text);
  scrollChat();
}

function typeText(el, text) {
  return new Promise(resolve => {
    let i = 0;
    el.innerHTML = '<span class="cursor"></span>';
    const interval = setInterval(() => {
      if (i < text.length) {
        const char = text[i] === '\n' ? '<br>' : escapeHtml(text[i]);
        el.innerHTML = el.innerHTML.replace('<span class="cursor"></span>', '') + char + '<span class="cursor"></span>';
        i++;
        scrollChat();
      } else {
        clearInterval(interval);
        el.innerHTML = el.innerHTML.replace('<span class="cursor"></span>', '');
        resolve();
      }
    }, 20);
  });
}

function scrollChat() {
  const m = document.getElementById('chatMessages');
  m.scrollTop = m.scrollHeight;
}

function escapeHtml(str) {
  const d = document.createElement('div');
  d.textContent = str;
  return d.innerHTML;
}

// â”€â”€ Dify API â”€â”€
async function callDifyAPI(query) {
  isTyping = true;
  addTypingIndicator();
  disableChatInput(true);

  try {
    const res = await fetch(API_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${API_KEY}`
      },
      body: JSON.stringify({
        inputs: {},
        query: query,
        response_mode: 'blocking',
        conversation_id: conversationId || '',
        user: 'demo-user-' + Date.now()
      })
    });

    if (!res.ok) throw new Error(`HTTP ${res.status}`);

    const data = await res.json();
    conversationId = data.conversation_id || conversationId;
    const answer = data.answer || 'ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚å›ç­”ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚';
    await addAIBubble(answer);
  } catch (err) {
    console.error('API Error:', err);
    removeTypingIndicator();
    await addAIBubble('ãŠå•ã„åˆã‚ã›ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚\n\nç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ãŒã€ãŸã ã„ã¾ã‚·ã‚¹ãƒ†ãƒ ã«ä¸€æ™‚çš„ãªå•é¡ŒãŒç™ºç”Ÿã—ã¦ã„ã¾ã™ã€‚\næ‹…å½“è€…ã‚ˆã‚Š24æ™‚é–“ä»¥å†…ã«ã”é€£çµ¡ã„ãŸã—ã¾ã™ã€‚\n\nãŠæ€¥ãã®å ´åˆã¯ã€ç›´æ¥ãƒ¡ãƒ¼ãƒ«ã«ã¦ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚');
  } finally {
    isTyping = false;
    disableChatInput(false);
  }
}

function disableChatInput(disabled) {
  document.getElementById('chatInput').disabled = disabled;
  document.getElementById('chatSendBtn').disabled = disabled;
}

// â”€â”€ Chat Continue â”€â”€
function sendChatMessage() {
  const input = document.getElementById('chatInput');
  const text = input.value.trim();
  if (!text || isTyping) return;

  input.value = '';
  input.style.height = 'auto';
  addUserBubble(text);
  callDifyAPI(text);
}

function handleChatKey(e) {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendChatMessage();
  }
}

// Auto-resize chat input
document.getElementById('chatInput').addEventListener('input', function() {
  this.style.height = 'auto';
  this.style.height = Math.min(this.scrollHeight, 120) + 'px';
});

// â”€â”€ Keyboard Navigation â”€â”€
document.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    if (currentStep >= 1 && currentStep <= 2) {
      e.preventDefault();
      nextStep(currentStep);
    } else if (currentStep === 4 && e.ctrlKey) {
      e.preventDefault();
      nextStep(4);
    }
  }
});

// Clear errors on input
document.getElementById('inputName').addEventListener('input', () => document.getElementById('errorName').classList.remove('show'));
document.getElementById('inputEmail').addEventListener('input', () => document.getElementById('errorEmail').classList.remove('show'));
document.getElementById('inputMessage').addEventListener('input', () => document.getElementById('errorMessage').classList.remove('show'));

// Init
updateProgress();
</script>
</body>
</html>
